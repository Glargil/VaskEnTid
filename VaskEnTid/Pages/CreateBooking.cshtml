@page
@model VaskEnTid.Pages.CreateBookingModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<div class="card-body text-center">
    <form method="post">
        <div class="form-group">
            <label for="SelectedTenantId">Vælg Beboer:</label>
            <select asp-for="SelectedTenantId" asp-items="Model.Tenants" class="form-control" id="SelectedTenantId"></select>
        </div>
        <div class="form-group">
            <label for="SelectedMachineId">Vælg Maskine:</label>
            <select asp-for="SelectedMachineId" asp-items="Model.Machines" class="form-control" id="SelectedMachineId"></select>
        </div>
        <div class="form-group">
            <label for="SelectedDate">Vælg Dato:</label>
            <input type="date" asp-for="SelectedDate" class="form-control" id="SelectedDate" value="@Model.SelectedDate.ToString("yyyy-MM-dd")"/>
        </div>
        <select asp-for="SelectedAvailableSlot" class="form-control" id="SelectedAvailableSlot">
            @foreach (var slot in Model.AllSlots)
            {
                var isBooked = Model.Bookings.Any(b =>
                b.MachineID == Model.SelectedMachineId &&
                b.BookingDate == Model.SelectedDate.Date &&
                (int)b.StartSlot == int.Parse(slot.Value)
                );
                <option value="@slot.Value" disabled="@(isBooked ? "disabled" : null)" style="@(isBooked ? "color:red;" : "")">
                    @slot.Text @(isBooked ? "(Optaget)" : "")
                </option>
            }
        </select>
        <button type="submit" class="btn btn-primary mt-3">Book</button>
    </form>
    @if (TempData["BookingSuccess"] != null)
    {
        <div class="toast show bg-success text-white position-relative top-0 end-0 m-3" role="alert" aria-live="assertive" aria-atomic="true" id="bookingToast">
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-check-circle"></i> @TempData["BookingSuccess"]
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    }
    @if (TempData["BookingError"] != null)
    {
        <div class="toast show bg-danger text-white position-relative top-0 end-0 m-3" role="alert" aria-live="assertive" aria-atomic="true" id="bookingToast">
            <div class="d-flex">
                <div class="toast-body">
                    <i class="fas fa-exclamation-triangle"></i> @TempData["BookingError"]
                </div>
                <button type="button" class="btn-close btn-close-white me-2 m-auto" data-bs-dismiss="toast" aria-label="Close"></button>
            </div>
        </div>
    }

</div>
<script>
    window.addEventListener('DOMContentLoaded', (event) => {
        var toastEl = document.getElementById('bookingToast');
        if (toastEl) {
            var toast = new bootstrap.Toast(toastEl, { delay: 10000 });
            toast.show();
        }
    });
</script>