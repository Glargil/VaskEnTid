@page
@model VaskEnTid.Pages.CreateBookingModel
@addTagHelper *, Microsoft.AspNetCore.Mvc.TagHelpers

<div class="card-body text-center">
    <form method="post">
        <div class="form-group">
            <label for="SelectedTenantId">Vælg Beboer:</label>
            <select asp-for="SelectedTenantId" asp-items="Model.Tenants" class="form-control" id="SelectedTenantId"></select>
        </div>
        <div class="form-group">
            <label for="SelectedMachineId">Vælg Maskine:</label>
            <select asp-for="SelectedMachineId" asp-items="Model.Machines" class="form-control" id="SelectedMachineId" onchange="this.form.submit()"></select>
        </div>
        <div class="form-group">
            <label for="SelectedDate">Vælg Dato:</label>
            <input type="date" asp-for="SelectedDate" class="form-control" id="SelectedDate" value="@Model.SelectedDate.ToString("yyyy-MM-dd")" onchange="this.form.submit()" />
        </div>
        <select asp-for="SelectedAvailableSlot" class="form-control" id="SelectedAvailableSlot">
            @foreach (var slot in Model.AllSlots)
            {
                var isBooked = Model.Bookings.Any(b =>
                b.MachineID == Model.SelectedMachineId &&
                b.BookingDate == Model.SelectedDate.Date &&
                (int)b.StartSlot == int.Parse(slot.Value)
                );
                <option value="@slot.Value" disabled="@(isBooked ? "disabled" : null)" style="@(isBooked ? "color:red;" : "")">
                    @slot.Text @(isBooked ? "(Optaget)" : "")
                </option>
            }
        </select>
        <button type="submit" class="btn btn-primary mt-3">Book</button>
    </form>
    @if (TempData["BookingSuccess"] != null)
    {
        <div class="toast show bg-success text-white" style="position: fixed; top: 1rem; right: 1rem; z-index: 9999;">
            <div class="toast-body">
                <i class="fas fa-check-circle"></i> @TempData["BookingSuccess"]
            </div>
        </div>
    }
    @if (TempData["BookingError"] != null)
    {
        <div class="toast show bg-danger text-white" style="position: fixed; top: 1rem; right: 1rem; z-index: 9999;">
            <div class="toast-body">
                <i class="fas fa-exclamation-triangle"></i> @TempData["BookingError"]
            </div>
        </div>
    }

</div>